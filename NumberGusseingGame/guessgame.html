<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Guessing Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Screen styles - only one visible at a time */
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }

        /* Welcome Screen */
        .welcome-screen {
            text-align: center;
            padding: 20px;
        }

        .welcome-icon {
            font-size: 5rem;
            color: #667eea;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .welcome-title {
            color: #333;
            font-size: 2.8rem;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-subtitle {
            color: #666;
            font-size: 1.3rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .game-rules {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 30px 0;
            text-align: left;
        }

        .game-rules h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rules-list {
            list-style: none;
        }

        .rules-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .rules-list li:last-child {
            border-bottom: none;
        }

        .rules-list i {
            color: #667eea;
            margin-top: 3px;
        }

        /* Header */
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        /* Game info */
        .game-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
        }

        .info-item {
            text-align: center;
        }

        .info-item .label {
            display: block;
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .info-item .value {
            display: block;
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        /* Input section */
        .input-section {
            margin-bottom: 25px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1rem;
        }

        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .error {
            color: #e53e3e;
            font-size: 0.9rem;
            margin-top: 5px;
            min-height: 20px;
        }

        /* Buttons */
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        .btn-welcome {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.3rem;
            padding: 20px 30px;
            margin: 20px 0;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 25px;
        }

        /* Guess history */
        .history-section {
            margin-top: 25px;
        }

        .history-title {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .guess-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
        }

        .guess-item {
            padding: 10px 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .guess-item.correct {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .guess-item.high {
            border-left-color: #f56565;
            background: #fff5f5;
        }

        .guess-item.low {
            border-left-color: #4299e1;
            background: #ebf8ff;
        }

        .guess-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .guess-status {
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .guess-item.correct .guess-status {
            background: #48bb78;
            color: white;
        }

        .guess-item.high .guess-status {
            background: #f56565;
            color: white;
        }

        .guess-item.low .guess-status {
            background: #4299e1;
            color: white;
        }

        /* Result screen */
        .result-card {
            text-align: center;
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #667eea;
        }

        .result-title {
            color: #333;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .result-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            text-align: left;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .detail-item:last-child {
            margin-bottom: 0;
        }

        .detail-item i {
            width: 24px;
            color: #667eea;
        }

        .result-message {
            margin: 25px 0;
            padding: 20px;
            border-radius: 10px;
            background: #f0fff4;
            border: 2px solid #48bb78;
        }

        /* History screen */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
        }

        .stat-card i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-card h3 {
            font-size: 2rem;
            color: #4a5568;
            margin-bottom: 5px;
        }

        .stat-card p {
            color: #718096;
            font-size: 0.9rem;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            padding-right: 10px;
        }

        .history-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .history-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .history-footer {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #a0aec0;
            font-size: 0.9rem;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #a0aec0;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
            color: #718096;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .welcome-title {
                font-size: 2.2rem;
            }
            
            .welcome-icon {
                font-size: 4rem;
            }
            
            .stats-summary {
                grid-template-columns: 1fr;
            }
            
            .history-details {
                grid-template-columns: 1fr;
            }
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .nav-buttons .btn {
            flex: 1;
            min-width: 150px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- WELCOME SCREEN -->
        <div id="welcomeScreen" class="screen active">
            <div class="welcome-screen">
                <div class="welcome-icon">
                    <i class="fas fa-gamepad"></i>
                </div>
                
                <h1 class="welcome-title">Number Guessing Game</h1>
                <p class="welcome-subtitle">
                    Welcome to the ultimate number guessing challenge!<br>
                    Test your intuition and see how quickly you can find the hidden number.
                </p>
                
                <div class="game-rules">
                    <h3><i class="fas fa-book"></i> How to Play</h3>
                    <ul class="rules-list">
                        <li>
                            <i class="fas fa-bullseye"></i>
                            <span><strong>Objective:</strong> Guess the secret number between 1 and 100</span>
                        </li>
                        <li>
                            <i class="fas fa-keyboard"></i>
                            <span><strong>Input:</strong> Enter your guess in the input field</span>
                        </li>
                        <li>
                            <i class="fas fa-lightbulb"></i>
                            <span><strong>Feedback:</strong> We'll tell you if your guess is too high, too low, or correct!</span>
                        </li>
                        <li>
                            <i class="fas fa-history"></i>
                            <span><strong>History:</strong> Track all your guesses and game history</span>
                        </li>
                        <li>
                            <i class="fas fa-trophy"></i>
                            <span><strong>Goal:</strong> Find the number in the fewest attempts possible!</span>
                        </li>
                    </ul>
                </div>
                
                <div class="stats-highlight">
                    <h3><i class="fas fa-chart-line"></i> Your Stats</h3>
                    <p id="welcomeStats" style="color: #666; margin: 15px 0;">
                        Loading your game statistics...
                    </p>
                </div>
                
                <button class="btn btn-welcome" onclick="startGame()">
                    <i class="fas fa-play-circle"></i> Start Playing Now!
                </button>
                
                <div style="margin-top: 30px;">
                    <p style="color: #888; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i>
                        Your game progress is automatically saved in your browser
                    </p>
                </div>
            </div>
        </div>

        <!-- HOME SCREEN -->
        <div id="homeScreen" class="screen">
            <h1><i class="fas fa-gamepad"></i> Number Guessing Game</h1>
            <p class="subtitle">Guess the number between 1 and 100!</p>
            
            <div class="game-info">
                <div class="info-item">
                    <span class="label">Target Range</span>
                    <span class="value">1 - 100</span>
                </div>
                <div class="info-item">
                    <span class="label">Attempts</span>
                    <span class="value" id="attemptCount">0</span>
                </div>
                <div class="info-item">
                    <span class="label">Game ID</span>
                    <span class="value" id="gameId">-</span>
                </div>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <label for="guessInput"><i class="fas fa-keyboard"></i> Enter your guess:</label>
                    <input type="number" id="guessInput" min="1" max="100" placeholder="Enter number 1-100" autofocus>
                    <div class="error" id="inputError"></div>
                </div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="submitGuess()">
                    <i class="fas fa-paper-plane"></i> Submit Guess
                </button>
                <button class="btn btn-secondary" onclick="startNewGame()">
                    <i class="fas fa-redo"></i> New Game
                </button>
                <button class="btn btn-outline" onclick="showScreen('welcomeScreen')">
                    <i class="fas fa-home"></i> Back to Welcome
                </button>
            </div>

            <div class="history-section">
                <h3 class="history-title"><i class="fas fa-list-ol"></i> Previous Guesses</h3>
                <div id="guessList" class="guess-list">
                    <div class="empty-state">No guesses yet. Make your first guess!</div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-outline" onclick="showScreen('historyScreen')">
                    <i class="fas fa-history"></i> View Game History
                </button>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="resultScreen" class="screen">
            <h1><i class="fas fa-chart-line"></i> Guess Result</h1>
            
            <div class="result-card">
                <div id="resultIcon" class="result-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                
                <h2 id="resultTitle" class="result-title">Processing...</h2>
                
                <div class="result-details">
                    <div class="detail-item">
                        <i class="fas fa-hashtag"></i>
                        <span>Your Guess: <strong id="userGuess">-</strong></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-bullseye"></i>
                        <span>Target Number: <strong id="targetNumber">-</strong></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-sort-amount-up"></i>
                        <span>Status: <strong id="guessStatus">-</strong></span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-clock"></i>
                        <span>Time: <strong id="guessTime">-</strong></span>
                    </div>
                </div>

                <div id="resultMessage" class="result-message">
                    <!-- Dynamic message will appear here -->
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="playAgain()">
                        <i class="fas fa-play-circle"></i> Play Again
                    </button>
                    <button class="btn btn-outline" onclick="showScreen('historyScreen')">
                        <i class="fas fa-history"></i> View History
                    </button>
                    <button class="btn btn-outline" onclick="showScreen('homeScreen')">
                        <i class="fas fa-home"></i> Back to Game
                    </button>
                    <button class="btn btn-outline" onclick="showScreen('welcomeScreen')">
                        <i class="fas fa-home"></i> Welcome Screen
                    </button>
                </div>
            </div>
        </div>

        <!-- HISTORY SCREEN -->
        <div id="historyScreen" class="screen">
            <h1><i class="fas fa-history"></i> Game History</h1>
            <p class="subtitle">View all your past guessing game results</p>

            <div class="nav-buttons">
                <button class="btn btn-danger" onclick="clearHistory()">
                    <i class="fas fa-trash-alt"></i> Clear All History
                </button>
                <button class="btn btn-secondary" onclick="loadHistory()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-outline" onclick="exportHistory()">
                    <i class="fas fa-download"></i> Export Data
                </button>
                <button class="btn btn-outline" onclick="showScreen('welcomeScreen')">
                    <i class="fas fa-home"></i> Welcome Screen
                </button>
            </div>

            <div class="stats-summary">
                <div class="stat-card">
                    <i class="fas fa-gamepad"></i>
                    <h3 id="totalGames">0</h3>
                    <p>Total Games</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-trophy"></i>
                    <h3 id="wins">0</h3>
                    <p>Games Won</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-bullseye"></i>
                    <h3 id="totalGuesses">0</h3>
                    <p>Total Guesses</p>
                </div>
            </div>

            <div class="history-section">
                <h3 class="history-title"><i class="fas fa-list"></i> All Game Results</h3>
                <div id="historyList" class="history-list">
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>No Game History</h3>
                        <p>Play some games to see your history here!</p>
                    </div>
                </div>
            </div>

            <div class="nav-buttons">
                <button class="btn btn-primary" onclick="showScreen('homeScreen')">
                    <i class="fas fa-play-circle"></i> Back to Game
                </button>
            </div>
        </div>

        <footer>
            <p>Data stored locally in your browser | Game ID: <span id="currentGameId">-</span></p>
        </footer>
    </div>

    <script>
        // ============================
        // GAME STATE
        // ============================
        let currentGame = {
            id: null,
            targetNumber: null,
            attempts: [],
            startTime: null,
            active: false
        };

        // ============================
        // INITIALIZATION
        // ============================
        document.addEventListener('DOMContentLoaded', function() {
            // Check for saved game
            const savedGame = localStorage.getItem('currentGuessingGame');
            if (savedGame) {
                try {
                    currentGame = JSON.parse(savedGame);
                    // Restore Date objects
                    currentGame.startTime = new Date(currentGame.startTime);
                    currentGame.attempts.forEach(attempt => {
                        attempt.timestamp = new Date(attempt.timestamp);
                    });
                } catch (e) {
                    console.log('Starting new game due to error:', e);
                    startNewGame();
                }
            } else {
                startNewGame();
            }
            
            // Update welcome screen stats
            updateWelcomeStats();
        });

        // ============================
        // WELCOME SCREEN FUNCTIONS
        // ============================
        function startGame() {
            showScreen('homeScreen');
            // Focus on input field
            setTimeout(() => {
                document.getElementById('guessInput').focus();
            }, 100);
        }

        function updateWelcomeStats() {
            const history = JSON.parse(localStorage.getItem('guessingGameHistory') || '[]');
            const statsElement = document.getElementById('welcomeStats');
            
            if (history.length === 0) {
                statsElement.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <i class="fas fa-user" style="font-size: 2rem; color: #667eea; margin-bottom: 10px;"></i>
                        <p style="font-size: 1.1rem; color: #666;">No games played yet.<br>Start your first game now!</p>
                    </div>
                `;
                return;
            }
            
            // Count unique games
            const gameIds = [...new Set(history.map(h => h.gameId))];
            const totalGames = gameIds.length;
            
            // Count wins
            const wins = gameIds.filter(gameId => {
                const gameHistory = history.filter(h => h.gameId === gameId);
                return gameHistory.some(h => h.won);
            }).length;
            
            // Calculate best score (minimum attempts for won games)
            let bestScore = Infinity;
            gameIds.forEach(gameId => {
                const gameHistory = history.filter(h => h.gameId === gameId);
                if (gameHistory.some(h => h.won)) {
                    const attempts = Math.max(...gameHistory.map(h => h.attemptNumber));
                    if (attempts < bestScore) {
                        bestScore = attempts;
                    }
                }
            });
            
            // Calculate win percentage
            const winPercentage = totalGames > 0 ? Math.round((wins / totalGames) * 100) : 0;
            
            statsElement.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; text-align: center;">
                    <div style="background: #f0f7ff; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: #667eea;">${totalGames}</div>
                        <div style="color: #666; font-size: 0.9rem;">Games Played</div>
                    </div>
                    <div style="background: #f0fff4; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: #48bb78;">${wins}</div>
                        <div style="color: #666; font-size: 0.9rem;">Games Won</div>
                    </div>
                    <div style="background: #fff5f5; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: #f56565;">${winPercentage}%</div>
                        <div style="color: #666; font-size: 0.9rem;">Win Rate</div>
                    </div>
                    <div style="background: #faf5ff; padding: 15px; border-radius: 10px;">
                        <div style="font-size: 1.8rem; font-weight: bold; color: #9f7aea;">${bestScore === Infinity ? '-' : bestScore}</div>
                        <div style="color: #666; font-size: 0.9rem;">Best Score</div>
                    </div>
                </div>
            `;
        }

        // ============================
        // GAME FUNCTIONS
        // ============================
        function startNewGame() {
            currentGame.id = 'game_' + Date.now();
            currentGame.targetNumber = Math.floor(Math.random() * 100) + 1;
            currentGame.attempts = [];
            currentGame.startTime = new Date();
            currentGame.active = true;
            
            saveGameState();
            updateGameDisplay();
            
            console.log('New game started. Target number:', currentGame.targetNumber);
        }

        function submitGuess() {
            const input = document.getElementById('guessInput');
            const errorDiv = document.getElementById('inputError');
            const guess = parseInt(input.value.trim());
            
            // Clear previous errors
            errorDiv.textContent = '';
            input.classList.remove('error');
            
            // Validate input
            if (!input.value.trim()) {
                showError('Please enter a number');
                return;
            }
            
            if (isNaN(guess)) {
                showError('Please enter a valid number');
                return;
            }
            
            if (guess < 1 || guess > 100) {
                showError('Please enter a number between 1 and 100');
                return;
            }
            
            // Check the guess
            const result = checkGuess(guess);
            const attempt = {
                guess: guess,
                result: result,
                timestamp: new Date()
            };
            
            currentGame.attempts.push(attempt);
            
            // Save to game history
            saveGameResult(guess, result);
            
            // Update display
            updateGameDisplay();
            
            // Clear input
            input.value = '';
            input.focus();
            
            // Show result screen
            showResult(guess, result);
            
            // If correct, start new game after delay
            if (result === 'correct') {
                setTimeout(() => {
                    startNewGame();
                    showScreen('homeScreen');
                }, 3000);
            }
        }

        function checkGuess(guess) {
            if (guess === currentGame.targetNumber) {
                currentGame.active = false;
                return 'correct';
            } else if (guess > currentGame.targetNumber) {
                return 'high';
            } else {
                return 'low';
            }
        }

        function showResult(guess, result) {
            // Update result screen
            document.getElementById('userGuess').textContent = guess;
            document.getElementById('targetNumber').textContent = currentGame.targetNumber;
            document.getElementById('guessStatus').textContent = result.toUpperCase();
            document.getElementById('guessTime').textContent = new Date().toLocaleString();
            
            const resultIcon = document.getElementById('resultIcon');
            const resultTitle = document.getElementById('resultTitle');
            const resultMessage = document.getElementById('resultMessage');
            
            if (result === 'correct') {
                resultIcon.innerHTML = '<i class="fas fa-trophy"></i>';
                resultIcon.style.color = '#FFD700';
                resultTitle.textContent = 'Congratulations! ðŸŽ‰';
                resultMessage.innerHTML = `
                    <h3><i class="fas fa-party-horn"></i> You Won!</h3>
                    <p>You guessed the correct number <strong>${currentGame.targetNumber}</strong>!</p>
                    <p>You found it in <strong>${currentGame.attempts.length}</strong> attempts!</p>
                    <p style="font-size: 1.5rem; margin-top: 10px;">ðŸŽŠ ðŸ¥³ ðŸŽ‰</p>
                    <p style="margin-top: 15px; font-style: italic;">Starting a new game in 3 seconds...</p>
                `;
                resultMessage.style.background = '#f0fff4';
                resultMessage.style.borderColor = '#48bb78';
            } else if (result === 'high') {
                resultIcon.innerHTML = '<i class="fas fa-arrow-down"></i>';
                resultIcon.style.color = '#f56565';
                resultTitle.textContent = 'Too High!';
                resultMessage.innerHTML = `
                    <h3><i class="fas fa-exclamation-triangle"></i> Try a Lower Number</h3>
                    <p>Your guess <strong>${guess}</strong> is higher than the target number.</p>
                    <p>Try guessing a number lower than ${guess}.</p>
                    <p style="margin-top: 15px; color: #666; font-style: italic;">
                        <i class="fas fa-lightbulb"></i> Tip: The number is between 1 and ${guess - 1}
                    </p>
                `;
                resultMessage.style.background = '#fff5f5';
                resultMessage.style.borderColor = '#f56565';
            } else if (result === 'low') {
                resultIcon.innerHTML = '<i class="fas fa-arrow-up"></i>';
                resultIcon.style.color = '#4299e1';
                resultTitle.textContent = 'Too Low!';
                resultMessage.innerHTML = `
                    <h3><i class="fas fa-exclamation-triangle"></i> Try a Higher Number</h3>
                    <p>Your guess <strong>${guess}</strong> is lower than the target number.</p>
                    <p>Try guessing a number higher than ${guess}.</p>
                    <p style="margin-top: 15px; color: #666; font-style: italic;">
                        <i class="fas fa-lightbulb"></i> Tip: The number is between ${guess + 1} and 100
                    </p>
                `;
                resultMessage.style.background = '#ebf8ff';
                resultMessage.style.borderColor = '#4299e1';
            }
            
            // Show result screen
            showScreen('resultScreen');
        }

        function playAgain() {
            startNewGame();
            showScreen('homeScreen');
        }

        // ============================
        // DISPLAY FUNCTIONS
        // ============================
        function updateGameDisplay() {
            document.getElementById('attemptCount').textContent = currentGame.attempts.length;
            document.getElementById('gameId').textContent = currentGame.id ? currentGame.id.substring(5, 13) : '-';
            document.getElementById('currentGameId').textContent = currentGame.id ? currentGame.id.substring(5, 13) : '-';
            
            updateGuessList();
        }

        function updateGuessList() {
            const guessList = document.getElementById('guessList');
            
            if (currentGame.attempts.length === 0) {
                guessList.innerHTML = '<div class="empty-state">No guesses yet. Make your first guess!</div>';
                return;
            }
            
            let html = '';
            currentGame.attempts.forEach(attempt => {
                const time = attempt.timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                html += `
                    <div class="guess-item ${attempt.result}">
                        <div class="guess-value">${attempt.guess}</div>
                        <div class="guess-status">${attempt.result.toUpperCase()}</div>
                        <div style="font-size: 0.9rem; color: #666;">${time}</div>
                    </div>
                `;
            });
            
            guessList.innerHTML = html;
        }

        function showError(message) {
            const errorDiv = document.getElementById('inputError');
            const input = document.getElementById('guessInput');
            
            errorDiv.textContent = message;
            input.classList.add('error');
            input.focus();
        }

        // ============================
        // SCREEN NAVIGATION
        // ============================
        function showScreen(screenId) {
            // Hide all screens
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // Show selected screen
            document.getElementById(screenId).classList.add('active');
            
            // If showing history, reload it
            if (screenId === 'historyScreen') {
                loadHistory();
            }
            
            // If showing welcome screen, update stats
            if (screenId === 'welcomeScreen') {
                updateWelcomeStats();
            }
            
            // If showing home screen, focus input
            if (screenId === 'homeScreen') {
                setTimeout(() => {
                    document.getElementById('guessInput').focus();
                }, 100);
            }
        }

        // ============================
        // DATA STORAGE FUNCTIONS
        // ============================
        function saveGameState() {
            localStorage.setItem('currentGuessingGame', JSON.stringify(currentGame));
        }

        function saveGameResult(guess, result) {
            // Get existing history
            let history = JSON.parse(localStorage.getItem('guessingGameHistory') || '[]');
            
            // Create result object
            const gameResult = {
                gameId: currentGame.id,
                gameNumber: history.filter(h => h.gameId === currentGame.id).length + 1,
                attemptNumber: currentGame.attempts.length,
                guess: guess,
                target: currentGame.targetNumber,
                result: result,
                timestamp: new Date().toISOString(),
                won: result === 'correct'
            };
            
            // Add to history
            history.push(gameResult);
            
            // Save back to localStorage
            localStorage.setItem('guessingGameHistory', JSON.stringify(history));
            
            // Also save current game state
            saveGameState();
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('guessingGameHistory') || '[]');
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <h3>No Game History</h3>
                        <p>Play some games to see your history here!</p>
                    </div>
                `;
                updateStats([]);
                return;
            }
            
            // Group by game
            const games = {};
            history.forEach(result => {
                if (!games[result.gameId]) {
                    games[result.gameId] = {
                        id: result.gameId,
                        results: [],
                        won: false,
                        attempts: 0
                    };
                }
                games[result.gameId].results.push(result);
                games[result.gameId].won = games[result.gameId].won || result.won;
                games[result.gameId].attempts = Math.max(games[result.gameId].attempts, result.attemptNumber);
            });
            
            // Convert to array and sort by timestamp
            const gameArray = Object.values(games).sort((a, b) => {
                const aTime = new Date(a.results[a.results.length - 1].timestamp);
                const bTime = new Date(b.results[b.results.length - 1].timestamp);
                return bTime - aTime; // Newest first
            });
            
            // Display history
            let html = '';
            gameArray.forEach(game => {
                const lastResult = game.results[game.results.length - 1];
                const gameTime = new Date(lastResult.timestamp).toLocaleString();
                
                html += `
                    <div class="history-item">
                        <div class="history-header">
                            <span style="font-weight: bold; color: #333;">Game: ${game.id.substring(5, 13)}</span>
                            <span style="color: ${game.won ? '#48bb78' : '#f56565'}; font-weight: bold;">
                                ${game.won ? 'WON' : 'LOST'}
                            </span>
                        </div>
                        
                        <div class="history-details">
                            <div>
                                <small style="color: #666;">Target</small>
                                <div style="font-weight: bold;">${lastResult.target}</div>
                            </div>
                            <div>
                                <small style="color: #666;">Attempts</small>
                                <div style="font-weight: bold;">${game.attempts}</div>
                            </div>
                            <div>
                                <small style="color: #666;">Status</small>
                                <div style="font-weight: bold; color: ${game.won ? '#48bb78' : '#f56565'}">
                                    ${game.won ? 'WIN' : 'LOSS'}
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin: 10px 0;">
                            <strong>Guesses:</strong>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;">
                                ${game.results.map(result => `
                                    <span style="
                                        padding: 2px 8px;
                                        background: ${getResultColor(result.result)};
                                        color: white;
                                        border-radius: 4px;
                                        font-size: 0.9rem;
                                    ">
                                        ${result.guess}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="history-footer">
                            <i class="fas fa-clock"></i>
                            <span>${gameTime}</span>
                        </div>
                    </div>
                `;
            });
            
            historyList.innerHTML = html;
            updateStats(history);
        }

        function updateStats(history) {
            if (history.length === 0) {
                document.getElementById('totalGames').textContent = '0';
                document.getElementById('wins').textContent = '0';
                document.getElementById('totalGuesses').textContent = '0';
                return;
            }
            
            // Count unique games
            const gameIds = [...new Set(history.map(h => h.gameId))];
            const totalGames = gameIds.length;
            
            // Count wins
            const wins = gameIds.filter(gameId => {
                const gameHistory = history.filter(h => h.gameId === gameId);
                return gameHistory.some(h => h.won);
            }).length;
            
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('wins').textContent = wins;
            document.getElementById('totalGuesses').textContent = history.length;
        }

        function getResultColor(result) {
            switch(result) {
                case 'correct': return '#48bb78';
                case 'high': return '#f56565';
                case 'low': return '#4299e1';
                default: return '#a0aec0';
            }
        }

        function clearHistory() {
            if (confirm('Are you sure you want to clear all game history? This action cannot be undone.')) {
                localStorage.removeItem('guessingGameHistory');
                localStorage.removeItem('currentGuessingGame');
                startNewGame();
                loadHistory();
                updateWelcomeStats();
                alert('Game history cleared successfully!');
            }
        }

        function exportHistory() {
            const history = JSON.parse(localStorage.getItem('guessingGameHistory') || '[]');
            
            if (history.length === 0) {
                alert('No game history to export.');
                return;
            }
            
            // Convert to CSV
            const headers = ['Game ID', 'Attempt', 'Guess', 'Target', 'Result', 'Won', 'Timestamp'];
            const csvRows = history.map(result => [
                result.gameId,
                result.attemptNumber,
                result.guess,
                result.target,
                result.result,
                result.won ? 'Yes' : 'No',
                new Date(result.timestamp).toLocaleString()
            ]);
            
            const csvContent = [
                headers.join(','),
                ...csvRows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `guessing_game_history_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // ============================
        // KEYBOARD SUPPORT
        // ============================
        document.getElementById('guessInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitGuess();
            }
        });

        // Auto-focus input when returning to home screen
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && document.getElementById('homeScreen').classList.contains('active')) {
                document.getElementById('guessInput').focus();
            }
        });
    </script>
</body>
</html>